{% extends "base.html" %}
{% load static %}

{% block title %}{{ checklist.title|default:"Checklist" }} - PBOBot{% endblock title %}

{% block page_specific_css %}
<link rel="stylesheet" href="{% static 'pboapp/css/structure_selector.css' %}">
{% endblock %}

{% block content %}
<div class="content-wrapper-checklist">
    {% if checklist %}
    <div class="checklist-card">
        <div class="checklist-header">
            <h1 class="checklist-title">{{ checklist.title }}</h1>
            <a href="#" onclick="window.history.back(); return false;" class="checklist-close-button">
                <span class="material-icons-outlined">close</span>
            </a>
        </div>
        <p class="checklist-description">{{ checklist.description }}</p>

        <div class="checklist-item-wrapper">
            {% for item in checklist.items %}
            <!-- The main container for each task, with its unique ID -->
            <div class="checklist-item-card" data-task-id="{{ item.id }}" data-required="{{ item.required }}">
                <!-- Make the icon a button for manual toggling -->
                <button class="checklist-toggle-btn">
                    <span class="material-icons-outlined checklist-item-icon">radio_button_unchecked</span>
                </button>
                <div class="checklist-item-content">
                    <h2 class="checklist-item-title">{{ item.name }}</h2>
                    <p class="checklist-item-details">{{ item.details }}</p>
                    {% if item.link_url %}
                    <!-- The action link now has a data attribute pointing to the generator -->
                    <a class="checklist-item-action-link" href="{{ item.link_url }}" data-generator-url="{{ item.link_url }}">
                        {{ item.link_text }}
                        <span class="material-icons-outlined">navigate_next</span>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="checklist-footer">
            <!-- The final call to action, disabled by default -->
            <button id="compile-btn" class="btn btn-primary btn-large" disabled>
                Compile Application Documents
                <span class="material-icons-outlined" style="font-size: 1.25rem; margin-left: 0.5rem;">email</span>
            </button>
        </div>
    </div>
    {% else %}
    <div class="checklist-card">
        <h1 class="checklist-title">Checklist Not Found</h1>
        <p class="checklist-description">The requested checklist could not be found. Please return home and start over.</p>
        <div class="checklist-footer">
            <a href="{% url 'home' %}" class="btn btn-primary">Back to Home</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock content %}

{% block extra_scripts %}
<!-- Link to our new dashboard JavaScript file -->
<script src="{% static 'pboapp/js/structure_setup.js' %}"></script>
{% endblock %}